<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>AR Solar System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            font-family: Arial, sans-serif;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 9999;
        }
        
        #loading.hidden {
            display: none;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #instructions {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            font-size: 14px;
        }
        
        #status {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 13px;
        }
        
        .status-active {
            background: rgba(0, 150, 0, 0.9) !important;
        }
        
        a-scene {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }
        
        @media (max-width: 768px) {
            #instructions {
                font-size: 12px;
                padding: 10px 15px;
            }
            
            #status {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <p>A carregar experiÃªncia AR...</p>
        <p style="font-size: 12px; margin-top: 10px;">Preparando o reconhecimento de imagem...</p>
    </div>
    
    <div id="instructions">
        ðŸ“± Aponte a cÃ¢mara para a imagem "solar.jpg"
    </div>
    
    <div id="status">A inicializar...</div>

    <!-- Cena A-Frame com MindAR -->
    <a-scene
        mindar-image="imageTargetSrc: solar.mind; filterMinCF:0.0001; filterBeta: 0.01; warmupTolerance: 5; missTolerance: 5"
        color-space="sRGB"
        renderer="colorManagement: true; physicallyCorrectLights: true; precision: medium; antialias: true; alpha: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <!-- Assets -->
        <a-assets>
            <!-- Modelo 3D -->
            <a-asset-item id="solarModel" src="solar.glb"></a-asset-item>
        </a-assets>
        
        <!-- Entidade do marcador de imagem -->
        <a-entity mindar-image-target="targetIndex: 0">
            <!-- Grupo principal do modelo -->
            <a-entity id="model-container" position="0 0 0" rotation="0 0 0" scale="0.5 0.5 0.5">
                <!-- Modelo 3D -->
                <a-entity
                    gltf-model="#solarModel"
                    position="0 0 0"
                    rotation="0 0 0"
                    scale="1 1 1"
                    animation-mixer="clip: *; loop: repeat"
                    class="clickable">
                </a-entity>
                
                <!-- IluminaÃ§Ã£o ambiente suave -->
                <a-light type="ambient" color="#FFFFFF" intensity="0.6"></a-light>
                
                <!-- Luz direcional principal -->
                <a-light type="directional" 
                         color="#FFFFFF" 
                         intensity="0.8"
                         position="1 2 1"
                         castShadow="true"></a-light>
                
                <!-- Luz de preenchimento -->
                <a-light type="point" 
                         color="#FFFFFF" 
                         intensity="0.4" 
                         position="-1 1 1"
                         distance="5"
                         decay="2"></a-light>
            </a-entity>
        </a-entity>

        <!-- CÃ¢mara -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Prevenir comportamentos de zoom no mobile
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // GestÃ£o da interface
        const loadingEl = document.getElementById('loading');
        const statusEl = document.getElementById('status');
        const instructionsEl = document.getElementById('instructions');
        const sceneEl = document.querySelector('a-scene');
        
        // Aguardar carregamento da cena
        sceneEl.addEventListener('loaded', () => {
            console.log('Cena carregada');
            statusEl.textContent = 'Pronto! Procure o marcador...';
            
            setTimeout(() => {
                loadingEl.classList.add('hidden');
            }, 1000);
        });
        
        // Eventos de detecÃ§Ã£o do marcador
        const target = document.querySelector('[mindar-image-target]');
        
        if (target) {
            // Quando o marcador Ã© encontrado
            target.addEventListener('targetFound', event => {
                console.log('Marcador encontrado!');
                statusEl.textContent = 'âœ“ Marcador detetado!';
                statusEl.classList.add('status-active');
                instructionsEl.style.display = 'none';
                
                // AnimaÃ§Ã£o de entrada
                const modelContainer = document.getElementById('model-container');
                if (modelContainer) {
                    modelContainer.setAttribute('animation', {
                        property: 'scale',
                        from: '0 0 0',
                        to: '0.5 0.5 0.5',
                        dur: 600,
                        easing: 'easeOutBack'
                    });
                }
            });
            
            // Quando o marcador Ã© perdido
            target.addEventListener('targetLost', event => {
                console.log('Marcador perdido');
                statusEl.textContent = 'Procurando marcador...';
                statusEl.classList.remove('status-active');
                instructionsEl.style.display = 'block';
            });
        }
        
        // Tratamento de erros
        sceneEl.addEventListener('arError', (event) => {
            console.error('Erro AR:', event);
            statusEl.textContent = 'âŒ Erro ao inicializar AR';
            statusEl.style.background = 'rgba(150, 0, 0, 0.9)';
            loadingEl.classList.add('hidden');
        });
        
        // Log de inicializaÃ§Ã£o
        console.log('MindAR Image Tracking inicializado');
        console.log('Certifique-se de ter o arquivo solar.mind compilado');
        
        // OrientaÃ§Ã£o do dispositivo
        if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(response => {
                    if (response === 'granted') {
                        console.log('PermissÃ£o de orientaÃ§Ã£o concedida');
                    }
                })
                .catch(console.error);
        }
    </script>
</body>
</html>
